# Experiments

- 2026-01-20: CPU benchmark (headless --benchmark, 120 frames). 64 worlds: 7680 frames in 0.256s = 29,993 fps total; 256 worlds: 30,720 frames in 0.819s = 37,530 fps total.
- 2026-01-20: GPU benchmark (headless_gpu --benchmark, 120 frames). 64 worlds: 7680 frames in 18.055s = 425 fps total (6.65 per-world); 256 worlds: 30,720 frames in 39.25s = 783 fps total (3.06 per-world).
- 2026-01-20: CPU benchmark sweep (headless --benchmark, 120 frames). Worlds=1: 2,878 fps total; 8: 10,407; 32: 28,710; 64: 30,946; 128: 36,885; 256: 39,095; 512: 39,584; 1024: 39,827.
- 2026-01-20: GPU benchmark sweep (headless_gpu --benchmark, 120 frames). Worlds=1: 17.56 fps total; 8: 120.22; 32: 314.56; 64: 426.99; 128: 587.32; 256: 778.99; 512: 1332.88; 1024: 1965.51. (Per-world FPS declines with scale.)
- 2026-01-20: Nsight Systems (nsys profile, 512 worlds, 10 frames, --cuda-graph-trace=node). GPU kernel summary shows madronaMWGPUMegakernel_256_1_48 dominating: 10 instances, ~390 ms avg per frame (total 3.90s). CPU-side cudaStreamSynchronize accounts for ~93% of runtime, consistent with long GPU kernel time.
- 2026-01-20: Nsight Compute (ncu) attempt on madronaMWGPUMegakernel_256_1_48 failed due to ERR_NVGPUCTRPERM (no permission to access GPU performance counters). Collected no metrics.
- 2026-01-20: GPU benchmark with batched frames (headless_gpu --benchmark cpu_instrs.gb 120 512 0 4). Frames per world=480; total throughput 1297.16 fps (2.53 FPS/world), slightly worse than framesPerStep=1 baseline (~1332 fps), suggesting launch overhead is not the primary bottleneck.
- 2026-01-20: Attempted occupancy tuning via MADRONA_MWGPU_ENABLE_PGO=1 (to allow >1 blocks/SM) failed at NVJitLink with max-regcount mismatch errors for megakernel variants (e.g., madronaMWGPUMegakernel_256_{2..6}_48), so multi-block configs are currently unbuildable in this setup.
- 2026-01-20: Null-step baseline (no GB_run_frame, minimal component touches). CPU headless --benchmark --null-step cpu_instrs.gb 120 512: 143,306 fps total (~279.9 FPS/world). GPU headless_gpu --benchmark --null-step cpu_instrs.gb 120 512: 27,700,631 fps total (~54,102.8 FPS/world). ECS overhead is negligible relative to emulator cost.
