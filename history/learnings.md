# Learnings
- 2026-01-20: sameboy_core_gpu.cpp includes must stay in sync with SAMEBOY_CORE_SRCS in src/CMakeLists.txt for GPU aggregation.
- 2026-01-20: NVRTC compile defs must include sameboy_core_gpu.cpp in madrona_build_compile_defns SRCS so GPU builds see SameBoy C code.
- 2026-01-20: headless_gpu run hits NVRTC errors (time_t/time.h, FILE in apu.h, GB_SECTION zero-length arrays, typeof in gb.h, libcudacxx lacking std::memset/free), so bd-aww now depends on GPU-safe flags/time/audio/file-IO work.
- 2026-01-20: GPU builds now include sameboy_gpu_config.h via GB_GPU_BUILD in NVRTC flags, which defines GB_GPU_MODE and disables timekeeping/debugger/cheats/rewind/audio/file I/O for SameBoy on GPU.
- 2026-01-20: SameBoy build flags are now centralized (GB_DISABLE_TIMEKEEPING/AUDIO/FILE_IO + GB_DMG_ONLY) for CPU/GPU; GB_is_cgb/GB_is_sgb helpers return false when GB_DMG_ONLY is set.
- 2026-01-20: Added GB_init_no_alloc for external RAM/VRAM/MBC/ROM pointers; ownership flags prevent internal free/alloc and MBC RAM realloc.
- 2026-01-20: Guarded SameBoy core allocations with GB_MALLOC/GB_FREE/GB_REALLOC macros so GB_GPU_MODE builds avoid host malloc/free symbols.
- 2026-01-20: RTC/timekeeping now uses GB_HOST_TIME() (0 on GB_GPU_MODE/GB_DISABLE_TIMEKEEPING) so GPU builds avoid time()/time.h while CPU remains unchanged.
- 2026-01-20: File-based ROM/save-state/battery/cheat I/O is stubbed to ENOSYS under GB_DISABLE_FILE_IO; buffer-based save-state APIs still work.
- 2026-01-20: APU/audio is stubbed under GB_DISABLE_AUDIO with no-op helpers and register passthroughs to avoid FILE/std::audio symbols in GPU builds.
- 2026-01-20: GPU misaligned address faults can come from unaligned uint16_t casts in SameBoy memory.c (OAM/MBC7); use unaligned GB_OAM/GB_MBC read/write helpers under GB_GPU_MODE.
- 2026-01-20: headless cpu_instrs.gb did not complete within 600 frames in the current build (reached test 9 by 1000 frames).
- 2026-01-20: Added a fast_ppu flag; GB_advance_cycles now routes to GB_display_run_scanline when enabled.
- 2026-01-20: CPU Sim init now marks WRAM/VRAM/MBC RAM/ROM bindings as external to avoid frees when using SoA buffers.
- 2026-01-20: headless_gpu uses a device-allocated ROM pointer (cudaMalloc/cudaMemcpy) passed via Sim::Config; verified 60-frame run.
- 2026-01-20: compare_cpu_gpu harness hashes WRAM/VRAM/MBC RAM; cpu_instrs.gb 120f currently mismatches across all three buffers.
- 2026-01-20: compare_cpu_gpu now also hashes packed observations; cpu_instrs.gb 120f mismatches ObsPacked too.
- 2026-01-20: compare_cpu_gpu now exports per-frame PC/SP/LY/STAT; cpu_instrs.gb 120f shows register mismatch too.
- 2026-01-20: compare_cpu_gpu now supports --report JSON output and docs/determinism.md defines zero-drift thresholds.
- 2026-01-20: compare_cpu_gpu --report build/diff_report.json writes JSON even on failure; cpu_instrs.gb 120f still diverges across WRAM/VRAM/MBC/obs/regs.
- 2026-01-20: headless cpu_instrs.gb passes at 12000 frames on CPU; headless_gpu 12000f did not complete within 120s/300s/600s timeouts (still running after init).
- 2026-01-20: Enabled warnings-as-errors for project targets; SameBoy headers are treated as system and sameboy_core suppresses multichar/unused-result warnings so Werror builds succeed.
